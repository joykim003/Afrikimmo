{% extends 'base/base.html' %}
{% load static %}

{% block content %}
<div class="container mx-auto px-4 py-8" x-data="{ isFilterOpen: false }">
    <div class="flex flex-col md:flex-row gap-8">
        <!-- Filtres -->
        <div class="md:w-1/3">
            <!-- Bouton toggle filtres (mobile) -->
            <button @click="isFilterOpen = !isFilterOpen" 
                    class="w-full md:hidden bg-blue-600 text-white px-4 py-2 rounded-lg mb-4">
                <i class="fas" :class="{ 'fa-times': isFilterOpen, 'fa-filter': !isFilterOpen }"></i>
                <span x-text="isFilterOpen ? 'Masquer les filtres' : 'Afficher les filtres'"></span>
            </button>

            <!-- Formulaire de filtres -->
            <div class="bg-white rounded-lg shadow-md p-6"
                 :class="{'hidden md:block': !isFilterOpen, 'block': isFilterOpen}">
                <h2 class="text-xl font-semibold mb-6">Filtres</h2>
                <form hx-get="{% url 'properties:search' %}" 
                      hx-trigger="change delay:500ms, search" 
                      hx-target="#search-results"
                      class="space-y-6">
                    {% csrf_token %}
                    {% for field in form %}
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            {{ field.label }}
                        </label>
                        {{ field }}
                    </div>
                    {% endfor %}

                    <!-- Indicateur de chargement -->
                    <div class="htmx-indicator flex justify-center py-4">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                    </div>

                    <!-- Bouton de recherche -->
                    <div class="pt-4 border-t">
                        <button type="submit"
                                class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center justify-center gap-2">
                            <i class="fas fa-search"></i>
                            Rechercher
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Résultats -->
        <div class="md:w-2/3">
            <!-- Nombre de résultats -->
            <div class="mb-4 text-gray-600">
                <span id="results-count">{{ properties|length }}</span> résultat(s) trouvé(s)
            </div>
            
            <div id="search-results" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {% include 'properties/partials/search_results.html' %}
            </div>
        </div>
    </div>
</div>

<!-- Script pour fermer le menu au clic à l'extérieur -->
<script>
document.addEventListener('click', function(event) {
    if (!event.target.closest('[x-data]')) {
        document.querySelectorAll('[x-data]').forEach(el => {
            if (el.__x) {
                el.__x.$data.isFilterOpen = false;
            }
        });
    }
});
</script>
{% endblock %}